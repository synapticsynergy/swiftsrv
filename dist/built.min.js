angular.module("sqrtl.adventure",[]).controller("AdventureController",function(a,b,c,d){a.data=JSON.parse(window.localStorage.getItem("data"))[0],a.getNew=function(){c.dataShift(),a.data=JSON.parse(window.localStorage.getItem("data"))[0]},a.getUber=function(a){console.log("location coords ",a),window.localStorage.setItem("latitude",a.latitude.toString()),window.localStorage.setItem("longitude",a.longitude.toString()),c.getUber().then(function(a){console.log("redirect URL ",a),d.location.href=a})},a.address={long:a.data.location.coordinate.longitude,lat:a.data.location.coordinate.latitude,templateUrl:"http://maps.google.com/maps?q="+a.data.location.coordinate.latitude+","+a.data.location.coordinate.longitude},a.googleRedirect=function(){console.log(a.address.templateUrl),d.location.href=a.address.templateUrl}}),angular.module("sqrtl",["sqrtl.httpRequest","sqrtl.form","sqrtl.adventure","sqrtl.uber","ui.router","ngRoute","ui.bootstrap","ngLodash","stormpath","stormpath.templates","uiGmapgoogle-maps"]).config(function(a,b,c){b.when("uber","/uber").otherwise("/"),c.html5Mode(!0),a.state("form",{url:"/form",templateUrl:"app/form/form.html",controller:"FormController",sp:{authenticate:!0}}).state("adventure",{url:"/adventure",templateUrl:"app/adventureLand/Adventure.html",controller:"AdventureController",sp:{authenticate:!0}}).state("uber",{url:"/uber",templateUrl:"app/uber/uber.html",controller:"UberController",sp:{authenticate:!0}}).state("login",{url:"/login",templateUrl:"app/auth/login.html"}).state("register",{url:"/register",templateUrl:"app/auth/register.html"}).state("forgot",{url:"/forgot",templateUrl:"app/auth/forgotPassword.html"})}).run(function(a,b,c){a.uiRouter({loginState:"login",defaultPostLoginState:"form"}),b.$on("$sessionEnd",function(){c.transitionTo("login")})}),angular.module("sqrtl.form",[]).controller("FormController",function(a,b,c){a.adventure={},a.getLocationAndCategory=function(d,e){c.requestAdventures(d,e).then(function(a){return console.log(a),!0}).then(function(){a.data=window.localStorage.getItem("data")[0]}).then(function(){b.go("adventure")})}}),angular.module("sqrtl.httpRequest",["ngLodash"]).factory("Adventures",function(a,b){var c=function(b,c){var f="/api/getYelp";return a({method:"POST",url:f,data:JSON.stringify({term:c,location:b})}).then(function(a){return data=a.data.businesses.map(function(a){return{name:a.name,image:a.image_url.replace(/ms.jpg/i,"o.jpg"),isClosed:a.is_closed,rating:a.rating,ratingImg:a.rating_img_url,reviewCount:a.review_count,snippet:a.snippet,location:a.location}}),d(data),data=e(data),window.localStorage.setItem("data",JSON.stringify(data)),data=JSON.parse(window.localStorage.getItem("data")),data}).catch(function(a){console.error(a)})},d=function(a){a.sort(function(a,b){return a.reviewCount<b.reviewCount?1:a.reviewCount>b.reviewCount?-1:0})},e=function(a){var c=a.splice(0,5),d=b.shuffle(c),e=d.concat(a);return e},f=function(){data=JSON.parse(window.localStorage.getItem("data")),data.shift(),data=e(data),window.localStorage.setItem("data",JSON.stringify(data))},g=function(){return a({method:"GET",url:"/api/getUber"}).then(function(a){return a.data})},h=function(b){return a({method:"POST",url:"api/uberPrice",data:JSON.stringify(b)}).then(function(a){return a.data})},i=function(b){return a({method:"POST",url:"api/uberRide",data:JSON.stringify(b)}).then(function(a){return a.data})},j=function(){return console.log("called in http"),a({method:"GET",url:"/api/authGoogle"}).then(function(a){return console.log(a),a.data})};return{requestAdventures:c,dataShift:f,getUber:g,uberPrice:h,uberRide:i,authGoogle:j}}),angular.module("sqrtl.uber",["ngLodash","uiGmapgoogle-maps"]).controller("UberController",function(a,b,c){a.destination={latitude:"0",longitude:"0"},a.current={latitude:"0",longitude:"0"},a.calculated=!1,a.gotRide=!1,a.gotPrices=!1,a.geo=navigator.geolocation,a.map={center:{latitude:40.1451,longitude:-99.668},zoom:10},a.geoFindMe=function(b){a.geo.getCurrentPosition(function(a){b(a)})},a.getPrice=function(){a.trip={start_lat:a.current.latitude,start_long:a.current.longitude,final_lat:a.destination.latitude,final_long:a.destination.longitude},c.uberPrice(a.trip).then(function(b){console.log("price ",b),a.priceArray=b.prices,a.gotPrices=!0})},a.getRide=function(b,d){a.trip.productId=b,a.trip.name=d,console.log("trip ",a.trip),c.uberRide(a.trip).then(function(b){console.log("ride ",b),a.gotRide=!0})},a.geoFindMe(function(b){a.$apply(function(){a.current={latitude:b.coords.latitude,longitude:b.coords.longitude},a.destination={latitude:window.localStorage.getItem("latitude"),longitude:window.localStorage.getItem("longitude")},a.map.center.latitude=parseFloat(a.current.latitude),a.map.center.longitude=parseFloat(a.current.longitude),console.log(a.current),console.log(a.destination),console.log(a.map.center),a.calculated=!0})})});