angular.module("sqrtl.adventure",["ngTouch"]).controller("AdventureController",function(a,b,c,d,e){a.data=JSON.parse(window.localStorage.getItem("data"))[0];var f=e.findDistance(a.data.location.coordinate);f?a.distance=f+"km":a.distance=void 0,a.address={long:a.data.location.coordinate.longitude,lat:a.data.location.coordinate.latitude,templateUrl:"http://maps.google.com/maps?q="+a.data.location.coordinate.latitude+","+a.data.location.coordinate.longitude},a.getNew=function(){c.dataShift(),a.data=JSON.parse(window.localStorage.getItem("data"))[0];var b=e.findDistance(a.data.location.coordinate);b?a.distance=b+"km":a.distance=void 0},a.getUber=function(a){console.log("location coords ",a),window.localStorage.setItem("latitude",a.latitude.toString()),window.localStorage.setItem("longitude",a.longitude.toString()),c.getUber().then(function(a){console.log("redirect URL ",a),d.location.href=a})},a.moreDetails=function(){d.location.href=a.data.url},a.googleRedirect=function(){d.location.href=a.address.templateUrl}}),angular.module("sqrtl",["sqrtl.httpRequest","sqrtl.form","sqrtl.adventure","sqrtl.uber","ui.router","ngRoute","ui.bootstrap","ngLodash","stormpath","stormpath.templates","uiGmapgoogle-maps","ngTouch"]).config(function(a,b,c){b.when("uber","/uber").otherwise("/form"),c.html5Mode(!0),a.state("form",{url:"/form",templateUrl:"app/form/form.html",controller:"FormController",sp:{authenticate:!0}}).state("adventure",{url:"/adventure",templateUrl:"app/adventureLand/Adventure.html",controller:"AdventureController",sp:{authenticate:!0}}).state("uber",{url:"/uber",templateUrl:"app/uber/uber.html",controller:"UberController",sp:{authenticate:!0}}).state("login",{url:"/login",templateUrl:"app/auth/login.html"}).state("register",{url:"/register",templateUrl:"app/auth/register.html"}).state("forgot",{url:"/forgot",templateUrl:"app/auth/forgotPassword.html"})}).run(function(a,b,c){a.uiRouter({loginState:"login",defaultPostLoginState:"form"}),b.$on("$sessionEnd",function(){c.transitionTo("login")})}),angular.module("sqrtl.form",["uiGmapgoogle-maps","ngTouch"]).controller("FormController",function(a,b,c,d,e){e.ngClickOverrideEnabled(!0),a.geocoder=new google.maps.Geocoder,a.adventure={},a.cll=void 0,a.cllYelp=void 0,a.calculating=!1,a.location=void 0,a.getLocationAndCategory=function(d,e){c.requestAdventures(d,e,a.cllYelp).then(function(a){return console.log(a),!0}).then(function(){a.data=window.localStorage.getItem("data")[0]}).then(function(){b.go("adventure")})},a.findMe=function(){a.calculating=!0,c.geoFindMe(function(b){a.$apply(function(){a.cll={latitude:b.coords.latitude,longitude:b.coords.longitude},a.cllYelp=b.coords.latitude+","+b.coords.longitude,d.setCoordinates(a.cll),console.log("cll",a.cll),a.reverseGeocode(),a.calculating=!1})})},a.reverseGeocode=function(){var b=new google.maps.LatLng(a.cll.latitude,a.cll.longitude);a.geocoder.geocode({latLng:b},function(b,c){c==google.maps.GeocoderStatus.OK?a.$apply(function(){console.log("geocode results ",b[0].formatted_address),a.location=b[0].formatted_address}):console.log("Geocoder failed due to: "+c)})}}),angular.module("sqrtl.httpRequest",["ngLodash"]).factory("Adventures",function(a,b){var c=function(b,c,d){var e="/api/getYelp";return a({method:"POST",url:e,data:JSON.stringify({term:c,location:b,cll:d})}).then(function(a){return data=a.data.businesses.map(function(a){return{url:a.url,name:a.name,image:a.image_url.replace(/ms.jpg/i,"o.jpg"),isClosed:a.is_closed,rating:a.rating,ratingImg:a.rating_img_url,reviewCount:a.review_count,snippet:a.snippet,location:a.location}}),g(data),data=h(data),window.localStorage.setItem("data",JSON.stringify(data)),data=JSON.parse(window.localStorage.getItem("data")),data}).catch(function(a){console.error(a)})},d=function(){return a({method:"GET",url:"/api/getUber"}).then(function(a){return a.data})},e=function(b){return a({method:"POST",url:"api/uberPrice",data:JSON.stringify(b)}).then(function(a){return a.data})},f=function(b){return a({method:"POST",url:"api/uberRide",data:JSON.stringify(b)}).then(function(a){return a.data})},g=function(a){a.sort(function(a,b){return a.reviewCount<b.reviewCount?1:a.reviewCount>b.reviewCount?-1:0})},h=function(a){var c=a.splice(0,5),d=b.shuffle(c),e=d.concat(a);return e},i=function(){data=JSON.parse(window.localStorage.getItem("data")),data.shift(),data=h(data),window.localStorage.setItem("data",JSON.stringify(data))},j=function(a){navigator.geolocation.getCurrentPosition(function(b){a(b)})};return{requestAdventures:c,dataShift:i,getUber:d,uberPrice:e,uberRide:f,geoFindMe:j}}).factory("LocationFactory",function(a){var b,c,d=function(d){a.localStorage.setItem("LocationFactoryCoordinates",JSON.stringify(d)),b=d.longitude,c=d.latitude},e=function(a){Number.prototype.toRad=function(){return this*Math.PI/180};var d=c,e=b,f=a.latitude,g=a.longitude;if("number"==typeof d&&"number"==typeof f&&"number"==typeof e&&"number"==typeof g){var h=6371e3,i=d.toRad(),j=f.toRad(),k=(d-f).toRad(),l=(e-g).toRad(),m=Math.sin(k/2)*Math.sin(k/2)+Math.cos(i)*Math.cos(j)*Math.sin(l/2)*Math.sin(l/2),n=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m));return Math.floor(h*n)/1e3}};return{setCoordinates:d,findDistance:e}}),angular.module("sqrtl.uber",["uiGmapgoogle-maps","ngTouch"]).controller("UberController",function(a,b){a.destination={latitude:"0",longitude:"0"},a.current={latitude:"0",longitude:"0"},a.calculated=!1,a.gotRide=!1,a.gotPrices=!1,a.map={center:{latitude:40.1451,longitude:-99.668},zoom:10},a.getPrice=function(){a.trip={start_lat:a.current.latitude,start_long:a.current.longitude,final_lat:a.destination.latitude,final_long:a.destination.longitude},b.uberPrice(a.trip).then(function(b){console.log("price ",b),a.priceArray=b.prices,a.gotPrices=!0})},a.getRide=function(c,d){a.trip.productId=c,a.trip.name=d,console.log("trip ",a.trip),b.uberRide(a.trip).then(function(b){console.log("ride ",b),a.gotRide=!0})},a.FindMe=function(a){b.geoFindMe(a)},a.FindMe(function(b){a.$apply(function(){a.current={latitude:b.coords.latitude,longitude:b.coords.longitude},a.destination={latitude:window.localStorage.getItem("latitude"),longitude:window.localStorage.getItem("longitude")},a.map.center.latitude=parseFloat(a.current.latitude),a.map.center.longitude=parseFloat(a.current.longitude),console.log(a.current),console.log(a.destination),console.log(a.map.center),a.calculated=!0})})});